# ğŸ—ï¸ ResearchAI Architecture & Component Interaction

## ğŸ“ System Architecture Overview

### Layered Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Gradio UI          â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚   User Browser       â”‚     â”‚
â”‚  â”‚   (Port 7860)        â”‚         â”‚                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ HTTP/REST
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                  FastAPI Service                        â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  /healthz    â”‚  â”‚    /ask      â”‚  â”‚   /search   â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  endpoint    â”‚  â”‚  (planned)   â”‚  â”‚  (planned)  â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                    â”‚
        â”‚                      â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RETRIEVAL       â”‚  â”‚  GENERATION       â”‚  â”‚  ORCHESTRATION  â”‚
â”‚  LAYER           â”‚  â”‚  LAYER            â”‚  â”‚  LAYER          â”‚
â”‚                  â”‚  â”‚                   â”‚  â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ OpenSearch   â”‚ â”‚  â”‚ â”‚    Ollama     â”‚â”‚  â”‚ â”‚   Airflow   â”‚ â”‚
â”‚ â”‚ Store        â”‚ â”‚  â”‚ â”‚    LLM        â”‚â”‚  â”‚ â”‚   Scheduler â”‚ â”‚
â”‚ â”‚              â”‚ â”‚  â”‚ â”‚               â”‚â”‚  â”‚ â”‚             â”‚ â”‚
â”‚ â”‚ â€¢ Vector     â”‚ â”‚  â”‚ â”‚ â€¢ Prompt      â”‚â”‚  â”‚ â”‚ â€¢ DAG Mgmt  â”‚ â”‚
â”‚ â”‚   Search     â”‚ â”‚  â”‚ â”‚   Building    â”‚â”‚  â”‚ â”‚ â€¢ Task      â”‚ â”‚
â”‚ â”‚ â€¢ BM25       â”‚ â”‚  â”‚ â”‚ â€¢ Response    â”‚â”‚  â”‚ â”‚   Execution â”‚ â”‚
â”‚ â”‚ â€¢ Hybrid     â”‚ â”‚  â”‚ â”‚   Generation  â”‚â”‚  â”‚ â”‚ â€¢ Monitoringâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                             â”‚
        â”‚                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PROCESSING LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PDF        â”‚  â”‚     Text     â”‚  â”‚    Embedding         â”‚ â”‚
â”‚  â”‚   Extractor  â”‚â†’ â”‚  Normalizer  â”‚â†’ â”‚    Generator         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                     â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Hybrid     â”‚  â”‚   Text        â”‚  â”‚   HuggingFace        â”‚ â”‚
â”‚  â”‚  Extractor  â”‚  â”‚   Chunker     â”‚  â”‚   Embedder           â”‚ â”‚
â”‚  â”‚  â€¢ PDFMiner â”‚  â”‚   â€¢ Sliding   â”‚  â”‚   â€¢ e5-base-v2       â”‚ â”‚
â”‚  â”‚  â€¢ OCR      â”‚  â”‚     Window    â”‚  â”‚   â€¢ 768-dim vectors  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                    â”‚
        â”‚                      â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STORAGE LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   MinIO      â”‚  â”‚  PostgreSQL  â”‚  â”‚    OpenSearch        â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚ â€¢ Raw PDFs   â”‚  â”‚ â€¢ Chunks     â”‚  â”‚ â€¢ Vector Index       â”‚  â”‚
â”‚  â”‚ â€¢ Metadata   â”‚  â”‚ â€¢ Metadata   â”‚  â”‚ â€¢ Text Index         â”‚  â”‚
â”‚  â”‚ â€¢ S3-API     â”‚  â”‚ â€¢ Relations  â”‚  â”‚ â€¢ KNN Search         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                    â”‚
        â”‚                      â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Docker Network                        â”‚    â”‚
â”‚  â”‚              (researchai-network bridge)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Docker Volumes                        â”‚    â”‚
â”‚  â”‚  â€¢ pgdata  â€¢ minio  â€¢ airflow_logs  â€¢ airflow_plugins   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Architecture

### Ingestion Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  arXiv API   â”‚
â”‚  or Metadata â”‚
â”‚     File     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ JSON metadata
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Airflow DAG: ingest_arxiv_pdf       â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task: read_metadata()     â”‚     â”‚
â”‚  â”‚  â€¢ Parse JSON              â”‚     â”‚
â”‚  â”‚  â€¢ Validate structure      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task: ingest(metadata)    â”‚     â”‚
â”‚  â”‚  â€¢ For each paper:         â”‚     â”‚
â”‚  â”‚    - Extract arXiv ID      â”‚     â”‚
â”‚  â”‚    - Download PDF          â”‚     â”‚
â”‚  â”‚    - Calculate hash        â”‚     â”‚
â”‚  â”‚    - Upload to MinIO       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       MinIO Bucket       â”‚
â”‚    researchai/raw/pdfs/  â”‚
â”‚                          â”‚
â”‚  {hash1}.pdf             â”‚
â”‚  {hash2}.pdf             â”‚
â”‚  {hash3}.pdf             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MinIO PDF Storage     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ PDF files
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Airflow DAG: process_pdfs           â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task: list_pdf_keys()     â”‚     â”‚
â”‚  â”‚  â€¢ Connect to MinIO        â”‚     â”‚
â”‚  â”‚  â€¢ List all PDFs           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Dynamic Task Mapping      â”‚     â”‚
â”‚  â”‚  process_each_pdf.expand() â”‚     â”‚
â”‚  â”‚  â€¢ Parallel execution      â”‚     â”‚
â”‚  â”‚  â€¢ 4 tasks at once         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  For Each PDF (in parallel):        â”‚
â”‚                                     â”‚
â”‚  1. Download PDF from MinIO         â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  2. HybridPdfExtractor              â”‚
â”‚     â”œâ”€â–º PDFMiner (primary)          â”‚
â”‚     â””â”€â–º Tesseract OCR (fallback)    â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  3. TextNormalizer                  â”‚
â”‚     â€¢ Remove LaTeX                  â”‚
â”‚     â€¢ Fix spacing                   â”‚
â”‚     â€¢ Clean special chars           â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  4. Chunker                         â”‚
â”‚     â€¢ Sliding window                â”‚
â”‚     â€¢ 300 words/chunk               â”‚
â”‚     â€¢ 50 words overlap              â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  5. Database Writer                 â”‚
â”‚     â€¢ Insert into PostgreSQL        â”‚
â”‚     â€¢ Table: chunks                 â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  6. Cleanup                         â”‚
â”‚     â€¢ Delete temp PDF               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL Database    â”‚
â”‚                          â”‚
â”‚   Table: chunks          â”‚
â”‚   â”œâ”€ id                  â”‚
â”‚   â”œâ”€ source_file         â”‚
â”‚   â”œâ”€ chunk_index         â”‚
â”‚   â”œâ”€ chunk_text          â”‚
â”‚   â”œâ”€ created_at          â”‚
â”‚   â””â”€ indexed_at (NULL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Embedding & Indexing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL Database    â”‚
â”‚   (Unindexed chunks)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Batch of 100 chunks
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Airflow DAG: embed_and_index        â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task:                     â”‚     â”‚
â”‚  â”‚  load_unindexed_chunks()   â”‚     â”‚
â”‚  â”‚  â€¢ Query DB                â”‚     â”‚
â”‚  â”‚  â€¢ WHERE indexed_at IS NULLâ”‚     â”‚
â”‚  â”‚  â€¢ LIMIT 100               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task: embed_chunks()      â”‚     â”‚
â”‚  â”‚  â€¢ Load HF model           â”‚     â”‚
â”‚  â”‚  â€¢ Generate embeddings     â”‚     â”‚
â”‚  â”‚  â€¢ 768-dim vectors         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task:                     â”‚     â”‚
â”‚  â”‚  upsert_to_opensearch()    â”‚     â”‚
â”‚  â”‚  â€¢ Bulk upload             â”‚     â”‚
â”‚  â”‚  â€¢ Create doc IDs          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Task: mark_indexed()      â”‚     â”‚
â”‚  â”‚  â€¢ UPDATE indexed_at       â”‚     â”‚
â”‚  â”‚  â€¢ Track completion        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OpenSearch Index             â”‚
â”‚                                      â”‚
â”‚  Document Structure:                 â”‚
â”‚  {                                   â”‚
â”‚    "_id": "hash_chunkidx",          â”‚
â”‚    "chunk_text": "...",             â”‚
â”‚    "embedding": [0.1, -0.2, ...],   â”‚
â”‚    "chunk_index": 5,                â”‚
â”‚    "source_file": "hash.pdf"        â”‚
â”‚  }                                   â”‚
â”‚                                      â”‚
â”‚  Index Settings:                     â”‚
â”‚  â€¢ Type: knn_vector (768-dim)       â”‚
â”‚  â€¢ Method: HNSW                     â”‚
â”‚  â€¢ Space: cosinesimil               â”‚
â”‚  â€¢ Engine: nmslib                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Interaction Map

### Service Communication Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ Service     â”‚ PSQL â”‚ MinIO â”‚ OSe â”‚ Airflow   â”‚ API  â”‚ UI â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ PostgreSQL  â”‚  -   â”‚   -   â”‚  -  â”‚    R/W    â”‚  R   â”‚ -  â”‚
â”‚ MinIO       â”‚  -   â”‚   -   â”‚  -  â”‚    R/W    â”‚  R   â”‚ -  â”‚
â”‚ OpenSearch  â”‚  -   â”‚   -   â”‚  -  â”‚     W     â”‚  R   â”‚ -  â”‚
â”‚ Airflow     â”‚ R/W  â”‚  R/W  â”‚  W  â”‚     -     â”‚  -   â”‚ -  â”‚
â”‚ API         â”‚  R   â”‚   R   â”‚  R  â”‚     -     â”‚  -   â”‚ W  â”‚
â”‚ UI          â”‚  -   â”‚   -   â”‚  -  â”‚     -     â”‚ R/W  â”‚ -  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

R = Read, W = Write
```

### Detailed Component Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Airflow                               â”‚
â”‚  (Orchestrator - Depends on everything)                     â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
   â”‚               â”‚                  â”‚                    â”‚
   â”‚ DAG 1         â”‚ DAG 2            â”‚ DAG 3              â”‚
   â”‚               â”‚                  â”‚                    â”‚
   â–¼               â–¼                  â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MinIO â”‚       â”‚MinIO â”‚          â”‚ PSQL â”‚           â”‚   PSQL   â”‚
â”‚ (W)  â”‚       â”‚ (R)  â”‚          â”‚ (W)  â”‚           â”‚   (R)    â”‚
â””â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚                                       â”‚
                  â–¼                                       â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
             â”‚  PSQL   â”‚                                  â”‚
             â”‚  (W)    â”‚                                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
                                                          â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚ OpenSearch â”‚
                                                   â”‚    (W)     â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API                                â”‚
â”‚  (Query Engine - Reads from all storage)                    â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚               â”‚                  â”‚
   â”‚ /ask          â”‚ /search          â”‚ /healthz
   â”‚               â”‚                  â”‚
   â–¼               â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ PSQL â”‚       â”‚OpenSearchâ”‚      â”‚ All  â”‚
â”‚ (R)  â”‚       â”‚   (R)    â”‚      â”‚Svcs  â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜
   â”‚                â”‚
   â”‚ Metadata       â”‚ Vectors + BM25
   â”‚                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Ollama    â”‚
    â”‚  (LLM Gen)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Response    â”‚
    â”‚   to User     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ API Integration Points

### Internal APIs

**MinIO (S3-Compatible API)**
```
Endpoint: http://minio:9000
Protocol: S3 API v4
Client: boto3

Operations:
  - PUT /bucket/object     â†’ Upload PDF
  - GET /bucket/object     â†’ Download PDF
  - HEAD /bucket/object    â†’ Check existence
  - LIST /bucket           â†’ List all PDFs
```

**PostgreSQL**
```
Endpoint: postgres:5432
Protocol: PostgreSQL wire protocol
Client: psycopg2 / SQLAlchemy

Operations:
  - INSERT INTO chunks     â†’ Store text chunks
  - SELECT FROM chunks     â†’ Load unindexed chunks
  - UPDATE chunks          â†’ Mark as indexed
```

**OpenSearch**
```
Endpoint: http://opensearch:9200
Protocol: REST API
Client: opensearch-py

Operations:
  - PUT /chunks/_doc/{id}  â†’ Index document
  - POST /chunks/_search   â†’ Search query
  - GET /chunks/_count     â†’ Get document count
  - POST /chunks/_bulk     â†’ Bulk upload
```

**Airflow**
```
Endpoint: http://airflow:8080
Protocol: REST API
Client: Web UI / airflow CLI

Operations:
  - GET /api/v1/dags       â†’ List DAGs
  - POST /api/v1/dags/{id}/dagRuns â†’ Trigger DAG
  - GET /api/v1/dags/{id}/dagRuns  â†’ Get run status
```

### External APIs

**arXiv API**
```
Endpoint: https://arxiv.org/
Protocol: HTTPS

Operations:
  - GET /pdf/{arxiv_id}.pdf    â†’ Download paper
  - GET /abs/{arxiv_id}        â†’ Get metadata
```

---

## ğŸ”€ Event Flow Diagrams

### Successful PDF Processing

```
User                Airflow         MinIO       Extractor    Normalizer   Chunker      Database
 â”‚                     â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚ Trigger DAG         â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ List PDFs   â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ [file1, file2]            â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ Download PDFâ”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ PDF bytes   â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ Extract text               â”‚             â”‚           â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚           â”‚            â”‚
 â”‚                     â”‚ Raw text                    â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚                             â”‚             â”‚           â”‚            â”‚
 â”‚                     â”‚ Normalize                   â”‚             â”‚           â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚            â”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚            â”‚
 â”‚                     â”‚ Clean text                                â”‚           â”‚            â”‚
 â”‚                     â”‚                                           â”‚           â”‚            â”‚
 â”‚                     â”‚ Chunk                                     â”‚           â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
 â”‚                     â”‚ [chunk1, chunk2, ...]                                  â”‚            â”‚
 â”‚                     â”‚                                                        â”‚            â”‚
 â”‚                     â”‚ Store chunks                                            â”‚            â”‚
 â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                     â”‚ Success                                                              â”‚
 â”‚                     â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚              â”‚             â”‚           â”‚            â”‚
 â”‚ Task Complete       â”‚             â”‚              â”‚             â”‚           â”‚            â”‚
```

### Embedding & Search Query

```
User         API        Database    Embedder    OpenSearch    LLM
 â”‚            â”‚            â”‚           â”‚             â”‚          â”‚
 â”‚ "What is   â”‚            â”‚           â”‚             â”‚          â”‚
 â”‚  RAG?"     â”‚            â”‚           â”‚             â”‚          â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚           â”‚             â”‚          â”‚
 â”‚            â”‚            â”‚           â”‚             â”‚          â”‚
 â”‚            â”‚ Embed query            â”‚             â”‚          â”‚
 â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚          â”‚
 â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚          â”‚
 â”‚            â”‚ Query vector            â”‚             â”‚          â”‚
 â”‚            â”‚                         â”‚             â”‚          â”‚
 â”‚            â”‚ Hybrid search (vector + BM25)         â”‚          â”‚
 â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚
 â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
 â”‚            â”‚ Top-K chunks                           â”‚          â”‚
 â”‚            â”‚                         â”‚             â”‚          â”‚
 â”‚            â”‚ Get metadata            â”‚             â”‚          â”‚
 â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚             â”‚          â”‚
 â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚             â”‚          â”‚
 â”‚            â”‚ Source info â”‚           â”‚             â”‚          â”‚
 â”‚            â”‚             â”‚           â”‚             â”‚          â”‚
 â”‚            â”‚ Build prompt            â”‚             â”‚          â”‚
 â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚            â”‚ Context + Question                               â”‚
 â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚            â”‚ Generated answer                                 â”‚
 â”‚            â”‚             â”‚           â”‚             â”‚          â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚           â”‚             â”‚          â”‚
 â”‚ Answer +   â”‚             â”‚           â”‚             â”‚          â”‚
 â”‚ Citations  â”‚             â”‚           â”‚             â”‚          â”‚
```

---

## ğŸ›ï¸ Configuration & Environment

### Service Configuration Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          docker-compose.yml                â”‚
â”‚  (Service orchestration & networking)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º .env file (environment variables)
               â”‚
               â”œâ”€â–º Service Dockerfiles
               â”‚   â”œâ”€ infra/airflow/Dockerfile
               â”‚   â”œâ”€ docker/api/Dockerfile
               â”‚   â””â”€ docker/ui/Dockerfile
               â”‚
               â””â”€â–º Volume mounts
                   â”œâ”€ Code: ./services â†’ /opt/researchai/services
                   â”œâ”€ DAGs: ./dags â†’ /opt/airflow/dags
                   â”œâ”€ Data: ./data â†’ /opt/airflow/data
                   â””â”€ Logs: airflow_logs â†’ /opt/airflow/logs
```

### Environment Variable Flow

```
Host Machine (.env)
        â”‚
        â”œâ”€â–º docker-compose.yml (${VAR} substitution)
        â”‚          â”‚
        â”‚          â””â”€â–º Container environment
        â”‚                     â”‚
        â”‚                     â””â”€â–º Application code (os.getenv())
        â”‚
        â””â”€â–º Example:
            .env: POSTGRES_USER=researchai
                        â†“
            docker-compose.yml: POSTGRES_USER: ${POSTGRES_USER}
                        â†“
            Container: env | grep POSTGRES_USER
                        â†“
            Python: os.getenv("POSTGRES_USER")
```

---

## ğŸ“¦ Module Organization

### Python Package Structure

```
services/
â”œâ”€â”€ __init__.py
â”‚
â”œâ”€â”€ chunkers/                    # Text chunking strategies
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                 # Abstract base class
â”‚   â”œâ”€â”€ sliding_window.py       # Window-based chunking
â”‚   â””â”€â”€ heading_aware.py        # Structure-based chunking
â”‚
â”œâ”€â”€ embedding/                   # Embedding generation
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ embedder.py             # Abstract interface
â”‚   â””â”€â”€ huggingface_embedder.py # HF implementation
â”‚
â”œâ”€â”€ ingestion/                   # Data ingestion
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ arxiv/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ client.py           # arXiv API client
â”‚       â”œâ”€â”€ config.py           # Configuration
â”‚       â”œâ”€â”€ runner.py           # Orchestration
â”‚       â”œâ”€â”€ writer.py           # MinIO writer
â”‚       â””â”€â”€ minio_utils.py      # Helper functions
â”‚
â”œâ”€â”€ processing/                  # PDF processing
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ extractors/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # Abstract extractor
â”‚   â”‚   â”œâ”€â”€ pdfminer_extractor.py
â”‚   â”‚   â””â”€â”€ hybrid_extractor.py
â”‚   â”œâ”€â”€ ocr/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ tesseract_ocr.py
â”‚   â”œâ”€â”€ normalization/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ text_normaliser.py
â”‚   â”œâ”€â”€ chunking/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ chunker.py
â”‚   â””â”€â”€ db_write/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ db_writer.py
â”‚
â””â”€â”€ search/                      # Search & retrieval
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ vector_store.py         # Abstract store
    â””â”€â”€ opensearch_store.py     # OpenSearch impl
```

### Import Patterns

```python
# From Airflow DAGs
from services.ingestion.arxiv.runner import ingest_pdfs_from_metadata
from services.processing.extractors.hybrid_extractor import HybridPdfExtractor
from services.embedding.huggingface_embedder import HuggingFaceEmbedder

# From API
from services.search.opensearch_store import OpenSearchStore
from services.embedding.embedder import Embedder

# From scripts
from services.processing.db_write.db_writer import write_chunks_to_db
```

---

## ğŸ” Security Considerations

### Network Isolation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Docker Network (Bridge Mode)       â”‚
â”‚     researchai-network                 â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Internal Services               â”‚ â”‚
â”‚  â”‚  â€¢ postgres:5432                 â”‚ â”‚
â”‚  â”‚  â€¢ opensearch:9200               â”‚ â”‚
â”‚  â”‚  â€¢ minio:9000                    â”‚ â”‚
â”‚  â”‚  â€¢ airflow:8080                  â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  Only accessible within network  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Port mappings
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Host Network                    â”‚
â”‚                                        â”‚
â”‚  Exposed Ports:                        â”‚
â”‚  â€¢ localhost:8080  â†’ airflow:8080     â”‚
â”‚  â€¢ localhost:9001  â†’ minio:9001       â”‚
â”‚  â€¢ localhost:8000  â†’ api:8000         â”‚
â”‚  â€¢ localhost:7860  â†’ ui:7860          â”‚
â”‚  â€¢ localhost:5435  â†’ postgres:5432    â”‚
â”‚  â€¢ localhost:9200  â†’ opensearch:9200  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Current Security Status

âš ï¸ **Development Mode - Not Production Ready**

- OpenSearch security plugin disabled
- Default credentials in use
- No HTTPS/TLS
- No authentication on API
- No rate limiting
- Direct database access exposed

ğŸ”’ **For Production:**
- Enable OpenSearch security
- Use strong, unique passwords
- Implement API authentication (JWT)
- Add TLS certificates
- Use secrets manager
- Close unnecessary ports
- Enable audit logging

---

## ğŸ“Š Monitoring & Observability

### Current Monitoring Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Airflow UI                            â”‚
â”‚  â€¢ DAG status                                           â”‚
â”‚  â€¢ Task duration                                        â”‚
â”‚  â€¢ Failure logs                                         â”‚
â”‚  â€¢ Execution history                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Compose Logs                         â”‚
â”‚  â€¢ Container output                                     â”‚
â”‚  â€¢ Error messages                                       â”‚
â”‚  â€¢ Application logs                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Service Health Checks                          â”‚
â”‚  â€¢ postgres: pg_isready                                 â”‚
â”‚  â€¢ opensearch: /_cluster/health                         â”‚
â”‚  â€¢ minio: /minio/health/ready                           â”‚
â”‚  â€¢ api: /healthz                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Planned Observability (M6)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Langfuse                            â”‚
â”‚  â€¢ Trace each request                                   â”‚
â”‚  â€¢ Log retrieval quality                                â”‚
â”‚  â€¢ Track LLM latency                                    â”‚
â”‚  â€¢ Monitor costs                                        â”‚
â”‚  â€¢ Collect user feedback                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated:** 2025-10-28
